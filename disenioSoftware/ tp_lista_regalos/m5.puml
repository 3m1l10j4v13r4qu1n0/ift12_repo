@startuml moduloCompraRegalos
title M5: M√≥dulo de Compra de Regalos (Detallado)

left to right direction
skinparam packageStyle rectangle

' ===== ESTILOS VISUALES =====
skinparam usecase {
    BackgroundColor White
    BorderColor Black
    BorderThickness 2
}

skinparam actor {
    BackgroundColor White
    BorderColor Black
    BorderThickness 2
}

skinparam package {
    BorderThickness 2
    FontStyle bold
}

' ===== ACTORES =====
actor "Invitado" as Invitado #Wheat
actor "Sistema de Pago" as Pago <<external>> #LightCyan

' ===== CASOS DE USO PRINCIPALES =====
package "Compra de Regalos - Principal" #LightCoral {
  usecase UC40 as "Seleccionar productos"
  usecase UC41 as "Revisar carrito"
  usecase UC42 as "Procesar pago"
  usecase UC43 as "Confirmar compra"
}

' ===== SUBM√ìDULO: SELECCI√ìN =====
package "Selecci√≥n de Productos" #MistyRose {
  usecase UC40a as "Agregar producto\nal carrito"
  usecase UC40b as "Definir cantidad\na comprar"
  usecase UC40c as "Seleccionar variante\n(color, tama√±o)"
  usecase UC40d as "Ver precio total"
  usecase UC40e as "Continuar comprando"
  usecase UC40f as "Proceder al pago"
}

' ===== SUBM√ìDULO: CARRITO =====
package "Gesti√≥n de Carrito" #LightPink {
  usecase UC41a as "Ver resumen\nde productos"
  usecase UC41b as "Modificar cantidad"
  usecase UC41c as "Eliminar producto"
  usecase UC41d as "Vaciar carrito"
  usecase UC41e as "Aplicar cup√≥n\nde descuento"
  usecase UC41f as "Ver total a pagar"
  usecase UC41g as "Guardar carrito\n(temporal)"
}

' ===== SUBM√ìDULO: RESERVA =====
package "Sistema de Reserva" #Salmon {
  usecase UC41h as "Reservar productos\ntemporalmente"
  usecase UC41i as "Iniciar temporizador\n(15 minutos)"
  usecase UC41j as "Notificar tiempo\nrestante"
  usecase UC41k as "Liberar reserva\n(timeout)"
  usecase UC41l as "Extender tiempo\nde reserva"
  usecase UC41m as "Cancelar reserva\nmanual"
}

' ===== SUBM√ìDULO: PERSONALIZACI√ìN =====
package "Personalizaci√≥n de Regalo" #PeachPuff {
  usecase UC42a as "Agregar mensaje\npersonalizado"
  usecase UC42b as "Elegir tarjeta\nde regalo"
  usecase UC42c as "Incluir nombre\ndel remitente"
  usecase UC42d as "Opci√≥n an√≥nimo"
  usecase UC42e as "Agregar foto\n(opcional)"
  usecase UC42f as "Vista previa\nde mensaje"
}

' ===== SUBM√ìDULO: PAGO =====
package "Procesamiento de Pago" #LightSalmon {
  usecase UC43a as "Ingresar datos\nde facturaci√≥n"
  usecase UC43b as "Seleccionar m√©todo\nde pago"
  usecase UC43c as "Pago con tarjeta"
  usecase UC43d as "Pago con transferencia"
  usecase UC43e as "Pago con wallet digital"
  usecase UC43f as "Validar datos de pago"
  usecase UC43g as "Procesar transacci√≥n"
  usecase UC43h as "Confirmar pago exitoso"
  usecase UC43i as "Manejar pago fallido"
}

' ===== SUBM√ìDULO: CONFIRMACI√ìN =====
package "Confirmaci√≥n y Post-Compra" #Coral {
  usecase UC44a as "Generar n√∫mero\nde orden"
  usecase UC44b as "Actualizar estado\nde productos"
  usecase UC44c as "Enviar confirmaci√≥n\npor email"
  usecase UC44d as "Generar comprobante PDF"
  usecase UC44e as "Mostrar resumen\nde compra"
  usecase UC44f as "Opci√≥n de compartir\nen redes"
  usecase UC44g as "Sugerir otros productos"
}

' ===== RELACIONES DE ACTORES =====
Invitado --> UC40
Invitado --> UC41
Invitado --> UC42
Invitado --> UC43

Pago --> UC43g

' ===== RELACIONES ENTRE CASOS DE USO =====

' Flujo Selecci√≥n
UC40 ..> UC40a : <<include>>
UC40 ..> UC40b : <<include>>
UC40 ..> UC40c : <<extend>>
UC40 ..> UC40d : <<include>>
UC40 ..> UC40e : <<extend>>
UC40 ..> UC40f : <<extend>>

UC40f ..> UC41 : <<include>>

' Flujo Carrito
UC41 ..> UC41a : <<include>>
UC41 ..> UC41b : <<extend>>
UC41 ..> UC41c : <<extend>>
UC41 ..> UC41d : <<extend>>
UC41 ..> UC41e : <<extend>>
UC41 ..> UC41f : <<include>>
UC41 ..> UC41g : <<extend>>
UC41 ..> UC41h : <<include>>

' Flujo Reserva
UC41h ..> UC41i : <<include>>
UC41i ..> UC41j : <<include>>
UC41i ..> UC41k : <<extend>>\n[timeout]
UC41i ..> UC41l : <<extend>>\n[solicitud]
UC41m ..> UC41h : <<precondition>>

' Flujo Personalizaci√≥n
UC42 ..> UC42a : <<include>>
UC42 ..> UC42b : <<extend>>
UC42 ..> UC42c : <<include>>
UC42 ..> UC42d : <<extend>>
UC42 ..> UC42e : <<extend>>
UC42 ..> UC42f : <<include>>

' Flujo Pago
UC42 ..> UC43a : <<include>>
UC43a ..> UC43b : <<include>>
UC43b ..> UC43c : <<extend>>
UC43b ..> UC43d : <<extend>>
UC43b ..> UC43e : <<extend>>
UC43c ..> UC43f : <<include>>
UC43d ..> UC43f : <<include>>
UC43e ..> UC43f : <<include>>
UC43f ..> UC43g : <<include>>
UC43g ..> UC43h : <<default>>
UC43g ..> UC43i : <<extend>>\n[error]

' Flujo Confirmaci√≥n
UC43h ..> UC43 : <<include>>
UC43 ..> UC44a : <<include>>
UC43 ..> UC44b : <<include>>
UC43 ..> UC44c : <<include>>
UC43 ..> UC44d : <<include>>
UC43 ..> UC44e : <<include>>
UC43 ..> UC44f : <<extend>>
UC43 ..> UC44g : <<extend>>

' Relaciones entre m√≥dulos principales
UC40 ..> UC42 : <<extend>>
UC41 ..> UC42 : <<include>>
UC42 ..> UC43 : <<include>>

' ===== NOTAS =====
note right of UC40
  **Flujo de selecci√≥n:**
  
  1. Invitado navega productos
  2. Selecciona uno o varios
  3. Define cantidades
  4. Ve resumen de selecci√≥n
  5. Procede al carrito
end note

note right of UC41h
  **Sistema de reserva:**
  
  ‚Ä¢ Duraci√≥n: 15 minutos
  ‚Ä¢ Evita compras duplicadas
  ‚Ä¢ Timer visible para el usuario
  ‚Ä¢ Alerta a los 5 min restantes
  ‚Ä¢ Auto-liberaci√≥n al expirar
  ‚Ä¢ Posibilidad de extender 1 vez
  
  Durante la reserva, otros
  invitados ven "En proceso"
end note

note bottom of UC42a
  **Mensaje personalizado:**
  
  M√°ximo 500 caracteres
  Puede incluir:
  ‚Ä¢ Felicitaciones personales
  ‚Ä¢ Recuerdos compartidos
  ‚Ä¢ Buenos deseos
  ‚Ä¢ Firma del remitente
  
  Opci√≥n de mantener
  anonimato ante otros invitados
  pero identificarse ante la pareja
end note

note bottom of UC43b
  **M√©todos de pago:**
  
  üí≥ **Tarjeta de cr√©dito/d√©bito**
     Visa, Mastercard, Amex
  
  üè¶ **Transferencia bancaria**
     Genera datos de cuenta
  
  üì± **Wallets digitales**
     MercadoPago, PayPal, etc.
  
  üí∞ **Pago en efectivo**
     C√≥digo para pago en efectivo
end note

note bottom of UC44b
  **Actualizaci√≥n de estado:**
  
  1. Productos marcados como "Comprado"
  2. Si es cantidad parcial: "Parcial"
  3. Cantidad restante se actualiza
  4. Tiempo real en toda la plataforma
  5. Notificaci√≥n a la pareja
  6. Email de confirmaci√≥n al invitado
end note

@enduml